(library
 (name sertoplib)
 (modules :standard \ sertop sercomp sertop_js sertop_async)
 (wrapped false)
 (preprocess (staged_pps ppx_import ppx_sexp_conv))
 (libraries cmdliner serapi serlib_ssr serlib_firstorder))

(executable
 (public_name sertop)
 (modules sertop)
 (link_flags -linkall)
 (libraries sertoplib))

(executable
 (public_name sercomp)
 (modules sercomp)
 (link_flags -linkall)
 (libraries sertoplib))

(executable
 (name sertop_js)
 (modules sertop_async sertop_js)
 (modes byte)
 (preprocess (staged_pps ppx_import ppx_sexp_conv))
 (js_of_ocaml
  (javascript_files ../jscoq/coq-libjs/mutex.js ../jscoq/coq-libjs/unix.js ../jscoq/coq-libjs/str.js ../jscoq/coq-libjs/coq_vm.js)
  (flags :standard --dynlink +nat.js +dynlink.js +toplevel.js))
  ; (flags --pretty --noinline --disable shortvar --debug-info))
 (link_flags -linkall)
 (libraries js_of_ocaml ppx_deriving_yojson.runtime sertoplib jscoq_lib))

(rule
 (targets ser_version.ml)
 (action (write-file %{targets} "let ser_git_version = \"%{version:coq-serapi}\";;")))

